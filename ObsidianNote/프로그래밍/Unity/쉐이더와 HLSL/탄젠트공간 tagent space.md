#unity/shader  #unity #TangentSpace #Normal

3d 물차에 울퉁불퉁한 질감 표현을 위해 노멀맵을 사용한다.
노멀맵은 각 픽셀이 어떤 노멀을 가지는지를 텍스쳐로 저장한 데이터이고
이것을 픽셀쉐이더에서 이노말 과 빛의 방향의 내적을 통해 
울퉁불퉁해 지는 라이팅연상을 수행한다.

이때 라이팅은 백터 값을 가지고 있기때문에 백터와 연산하기위해서는
같은 백터값이여야 하는데 
이때 라이팅을 월드좌표계를 사용하고
노말맵은 탄젠트공간 좌표를 사용한다.

그러면 이계산을 하기 위해서는
1. 탄젠트 공간상의 노멀 백터를 월드좌표로 보내던지 해야한다.
2. 라이팅 백터를 탄젠트 공간으로 보내던지

1번은 픽셀마다 이 변환을 해줘야하무로 연산이너무많아 부담이 크다
2번은 버텍스 쉐이더에서 빛방향을 탄제트 공간으로 변환하면 되기때문에 연상이 상대적으로 적다
따라서 2변을 상용한다.

노멀을 저장할때 타입은  물체공간노멀(로컬공간기준) 또는 탄젠트 좌표(표면공간기준) 로 저장한다.

## 노말의 종류
- Object Space Normal - 오브젝트기반 윌드스페이스 xyz 라고 생가하면 된다  회전을 해도 오브젝트에 붙어 있기  때문에 색이 바뀌지는 않는다
- View Spce Normal - 카메라에 노말 좌표가 붙어있느것 처럼 카메라가 바라보는 방향은 z임, z는 파랑색으로 표시됨으르 거의다 파랑으로 표시됨
- World space Normal - 월드기준에 맞춰서 노말이 계산 항상 윗부분은 Y(녹색)이다
- Tanget Space Normal - 모든면이 항상 위쪽(Z축)을 바라보고 있어 어떻게봐 다파랑색이다.


#### 로컬공간기준 물체공간노멀맵은
xyz을 표시하고 추가로 노멀정보를 하나 더표시하는 방식이다
따라서 좌표계는 다 동일하고 노말축만 계속 바뀐다.
즉, 노멀정보는 오브젝트공간 기준으로 설정되어있다는것이다.

#### 표면공간기준 탄젠트공간 노멀맵은
노말이 z축으로 해서 z축 기준인노말정보를 저장한 것을 탄젠트공간 노멀맵 이라고 한다.
따라서 xyz축은 z축이 노말로 생성되니까 좌표계가 다 다르다
표면이 둥글면 둥근 각버텍스에 맞는 둥근 노멀을 생성하면 그 노멀에 따라 각 버텍스마돠 좌표계가 전부 달라지는 것이다.
따라서 거의 모든 표면이 바깥쪽인 z축을 향에 있으므로 탄젠트 노멀맵은 거의 대부분 파랑새으로 표시된다.

계념적으로 더운 간단하고
더싸기도한  로컬공간기준 물체공간노멀맵을 쓰지 않는이유는
캐릭터의 피부와 물체의 회전이 있는경우 물체공간 노멀맵은
매 프레임 마다 노멀방향을 새롭게 계산해야한다

따라서 회전할 필요없는 산, 고정된 물건들은 물체공간 노멀맵을 사용해도 된다
표명공간 노멀맵보다 더 싸니까

또한 저장할 데이터가 적고 다른 모델에서 재사용을 할수있다는 점등이 있어서 탄제트 공간 노멀맵을 쓰게 된다.




## 탄젠트 공간

법선백터: 어떠한 직선이나 평면의 기울기나 경사각을 표현할때, 해당직선이나 평면에 수직인 백터

오브젝트 공간에 있는 어떤 점이 normal을 수직축으로 하는 공간
평면을 만들수있는 세점으로 평면을 만들고 그 평면의 수직인 법선 백터를 구할수있는데
이백터를 알면 평면이 어떤식으로 기울어져 있는지 알수있다.

탄젠트공간
한점의 법선백터
한점의 접선(탄젠트)백터 
바이노멀 백터: 법선백터와 접선 백터를 외적하면 구해지는 백터
의 세 백터를 축으로하는 공간이다.

한 폴리곤에서 밑변을 x축 높이(폴리곤기준)를  y축 밑변과 빗변사이에 끼인각을 "세타" 라고하면
tan 세타 = 높이 / 밑변 임으로 
tan값이 곧 기울이가된다 (탄젠트공간 이라고 불리는 이유)
이 기울가 z출 노멀이고 이것이 표시된다

폴리곤 평면에 수직인 법선으로 폴리곤의 기울기값을 만드고
접선의 나머지 두축으로어느 방향으로 기울어져 있는지을 알아네 세게의 축을 접선좌표계라고 하고 이 좌표계가 존재하는 공간을 접선공간 이라고한다.


법선은 정점마다 있어서 픽셀단위조명에서는 그 사이를 법선백터로 보간해서사용한다.
